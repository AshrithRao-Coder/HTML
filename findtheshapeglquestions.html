<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hidden‑Shape Quiz (Canvas Crop Method)</title>
  <style>
    body { background:#f6f6f6; font-family:Arial,sans-serif; }
    .container { max-width:980px; margin:40px auto; background:#fff;
                 padding:2em; border-radius:12px; box-shadow:0 0 15px #ccc; }
    .qnum { font-weight:bold; margin-bottom:.5em; }
    .timer { text-align:right; color:#d32f2f; font-weight:bold; }
    .frag, .options { text-align:center; }
    .frag canvas { border:2px solid #ddd; border-radius:6px; }
    .options { display:flex; justify-content:space-between; margin:1em 0; }
    .opt { cursor:pointer; transition:border .2s; }
    .opt canvas { width:90px; height:90px; border:2px solid #ddd; border-radius:6px; }
    .opt.selected canvas { border-color:#2196f3; }
    .opt.correct  canvas { border-color:#4caf50; }
    .opt.wrong    canvas { border-color:#d32f2f; opacity:.6; }
    .opt label { display:block; margin-top:4px; font-weight:bold; }
    .btn { padding:.6em 1.5em; background:#2196f3; color:#fff;
           border:none; border-radius:6px; font-size:1em; cursor:pointer; }
    .btn:disabled { background:#aaa; }
    .result { font-weight:bold; margin:1em 0; text-align:center; }
    .score { text-align:center; margin-top:2em; }
  </style>
</head>
<body>
  <div class="container">
    <div id="quiz"></div>
  </div>

  <script>
  // ——— 1) Crop definitions ———
  // You must measure these on your master image (images/page.png)
  const crops = [
    // Q1
    {
      frag: [  50, 150,  80,  80 ],
      opts: [
        [ 200, 140, 100, 100 ],
        [ 320, 140, 100, 100 ],
        [ 440, 140, 100, 100 ],
        [ 560, 140, 100, 100 ]
      ]
    },
    // Q2 … Q10: fill in the rest
    /* {
         frag: [ x,y,w,h ],
         opts: [ [x1,y1,w1,h1], … ]
       },
       …
    */
  ];

  // ——— 2) Answer key ——— (0=A,1=B,2=C,3=D)
  const answers = [1,2,2,1,0,3,3,2,1,2];

  // ——— 3) State ———
  let current=0, score=0, selected=null, timedOut=false;
  let masterImg = new Image(), timerId;

  // ——— 4) Boot ———
  masterImg.onload = () => renderQuestion();
  masterImg.src = 'images/page.png';

  function renderQuestion(){
    const q = crops[current];
    const quiz = document.getElementById('quiz');
    quiz.innerHTML = `
      <div class="qnum">Question ${current+1} of ${crops.length}</div>
      <div class="timer" id="timer">Time left: 30s</div>
      <div class="frag"><canvas id="fragCan" width="${q.frag[2]}" height="${q.frag[3]}"></canvas></div>
      <div class="options">
        ${['A','B','C','D'].map((L,i)=>`
          <div class="opt" id="opt${i}" onclick="pick(${i})">
            <canvas id="optCan${i}"
                    width="${q.opts[i][2]}" height="${q.opts[i][3]}"></canvas>
            <label>${L}</label>
          </div>
        `).join('')}
      </div>
      <div style="text-align:center;">
        <button class="btn" id="submitBtn" onclick="submit()" disabled>Submit</button>
      </div>
      <div class="result" id="result"></div>
    `;

    // draw fragment + options onto canvases
    // frag
    let [sx,sy,sw,sh] = q.frag,
        fcan = document.getElementById('fragCan').getContext('2d');
    fcan.drawImage(masterImg, sx,sy,sw,sh, 0,0, sw,sh);

    // options
    q.opts.forEach((r,i)=>{
      let [x,y,w,h] = r,
          ctx = document.getElementById('optCan'+i).getContext('2d');
      ctx.drawImage(masterImg, x,y,w,h, 0,0, w,h);
    });

    // reset state
    selected = null; timedOut = false;
    document.getElementById('submitBtn').disabled = true;
    ['A','B','C','D'].forEach((_,i)=>{
      document.getElementById('opt'+i).className = 'opt';
    });
    document.getElementById('result').innerHTML = '';

    // start timer
    let t=30;
    document.getElementById('timer').textContent = `Time left: ${t}s`;
    clearInterval(timerId);
    timerId = setInterval(()=>{
      t--; document.getElementById('timer').textContent = `Time left: ${t}s`;
      if(t===0){ clearInterval(timerId); timedOut=true; submit(); }
    },1000);
  }

  function pick(i){
    if(selected!==null) return;
    selected=i;
    document.getElementById('submitBtn').disabled = false;
    [0,1,2,3].forEach(j=>
      document.getElementById('opt'+j)
              .classList.toggle('selected', j===i)
    );
  }

  function submit(){
    if(selected===null && !timedOut) return;
    clearInterval(timerId);
    const correct = answers[current],
          resDiv = document.getElementById('result');

    if(timedOut){
      resDiv.innerHTML = `⏰ Time's up! Answer was <b>${'ABCD'[correct]}</b>`;
    } else if(selected===correct){
      resDiv.innerHTML = `<span style="color:green;">✔ Correct!</span>`;
      score++;
    } else {
      resDiv.innerHTML = `❌ Wrong. Correct: <b>${'ABCD'[correct]}</b>`;
    }

    // mark canvases
    [0,1,2,3].forEach(i=>{
      const el = document.getElementById('opt'+i);
      if(i===correct)   el.classList.add('correct');
      else if(i===selected) el.classList.add('wrong');
      el.classList.remove('selected');
    });

    // next after pause
    setTimeout(()=>{
      current++;
      if(current < crops.length) renderQuestion();
      else showScore();
    },1500);
  }

  function showScore(){
    document.getElementById('quiz').innerHTML = `
      <div class="score">
        <h2>All Done!</h2>
        <p>Your score: <b>${score}</b> / ${crops.length}</p>
        <button class="btn" onclick="location.reload()">Try Again</button>
      </div>
    `;
  }
  </script>
</body>
</html>
